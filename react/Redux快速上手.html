<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redux快速上手 | immoRtals</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="What would you like to know?">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.6d0ab0d3.js" as="script"><link rel="preload" href="/assets/js/2.fa3326c1.js" as="script"><link rel="preload" href="/assets/js/13.0c0f46e8.js" as="script"><link rel="prefetch" href="/assets/js/10.ed502d1a.js"><link rel="prefetch" href="/assets/js/11.d0823f85.js"><link rel="prefetch" href="/assets/js/12.359b20bf.js"><link rel="prefetch" href="/assets/js/14.7de874f5.js"><link rel="prefetch" href="/assets/js/15.bf8a6ee7.js"><link rel="prefetch" href="/assets/js/16.73110160.js"><link rel="prefetch" href="/assets/js/17.5518ce17.js"><link rel="prefetch" href="/assets/js/18.20957b24.js"><link rel="prefetch" href="/assets/js/19.8de64716.js"><link rel="prefetch" href="/assets/js/20.fa2974ec.js"><link rel="prefetch" href="/assets/js/21.0abac6cd.js"><link rel="prefetch" href="/assets/js/22.f0498cf6.js"><link rel="prefetch" href="/assets/js/23.56ca430d.js"><link rel="prefetch" href="/assets/js/24.a7441628.js"><link rel="prefetch" href="/assets/js/25.c9d7b471.js"><link rel="prefetch" href="/assets/js/26.a27cb519.js"><link rel="prefetch" href="/assets/js/27.3bd72116.js"><link rel="prefetch" href="/assets/js/3.648133d7.js"><link rel="prefetch" href="/assets/js/4.98cb80ad.js"><link rel="prefetch" href="/assets/js/5.842eb29f.js"><link rel="prefetch" href="/assets/js/6.580398af.js"><link rel="prefetch" href="/assets/js/7.1db00485.js"><link rel="prefetch" href="/assets/js/8.e685bdc2.js"><link rel="prefetch" href="/assets/js/9.bba85a0f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">immoRtals</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><span class="title">指南</span> <span class="arrow down"></span></button> <button type="button" aria-label="指南" class="mobile-dropdown-title"><span class="title">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/css/flex的几种多列布局.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/js/1深拷贝和浅拷贝.html" class="nav-link">
  JS
</a></li><li class="dropdown-item"><!----> <a href="/vue/vue-cli3.html" class="nav-link">
  VUE
</a></li><li class="dropdown-item"><!----> <a href="/react/create-react-app.html" class="nav-link">
  REACT
</a></li><li class="dropdown-item"><!----> <a href="/soft/nvm.html" class="nav-link">
  软件安装
</a></li><li class="dropdown-item"><!----> <a href="/accumulate/rule.html" class="nav-link">
  其它
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/immoRTALSzz/immoRTALSzz.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub地址
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><span class="title">指南</span> <span class="arrow down"></span></button> <button type="button" aria-label="指南" class="mobile-dropdown-title"><span class="title">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/css/flex的几种多列布局.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/js/1深拷贝和浅拷贝.html" class="nav-link">
  JS
</a></li><li class="dropdown-item"><!----> <a href="/vue/vue-cli3.html" class="nav-link">
  VUE
</a></li><li class="dropdown-item"><!----> <a href="/react/create-react-app.html" class="nav-link">
  REACT
</a></li><li class="dropdown-item"><!----> <a href="/soft/nvm.html" class="nav-link">
  软件安装
</a></li><li class="dropdown-item"><!----> <a href="/accumulate/rule.html" class="nav-link">
  其它
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/immoRTALSzz/immoRTALSzz.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub地址
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>VUE</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>REACT</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/react/create-react-app.html" class="sidebar-link">create-react-app</a></li><li><a href="/react/Redux快速上手.html" class="active sidebar-link">Redux快速上手</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/Redux快速上手.html#什么是redux" class="sidebar-link">什么是Redux</a></li><li class="sidebar-sub-header"><a href="/react/Redux快速上手.html#配置redux" class="sidebar-link">配置Redux</a></li><li class="sidebar-sub-header"><a href="/react/Redux快速上手.html#组织redux代码" class="sidebar-link">组织Redux代码</a></li><li class="sidebar-sub-header"><a href="/react/Redux快速上手.html#使用redux工具调试" class="sidebar-link">使用Redux工具调试</a></li><li class="sidebar-sub-header"><a href="/react/Redux快速上手.html#集成react" class="sidebar-link">集成React</a></li></ul></li><li><a href="/react/生命周期函数.html" class="sidebar-link">React的生命周期函数</a></li><li><a href="/react/hooks.html" class="sidebar-link">hooks</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>软件安装教程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其他</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="redux快速上手"><a href="#redux快速上手" class="header-anchor">#</a> Redux快速上手</h1> <p><a href="https://segmentfault.com/a/1190000011474522?utm_source=tag-newest" target="_blank" rel="noopener noreferrer">原文地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>典型的Web应用程序通常由共享数据的多个UI组件组成。通常，多个组件的任务是负责展示同一对象的不同属性。这个对象表示可随时更改的状态。在多个组件之间保持状态的一致性会是一场噩梦，特别是如果有多个通道用于更新同一个对象。</p> <h2 id="什么是redux"><a href="#什么是redux" class="header-anchor">#</a> 什么是Redux</h2> <p>Redux是一个流行的JavaScript框架，为应用程序提供一个可预测的状态容器。Redux基于简化版本的<font color="Crimson"><strong>Flux</strong></font>框架，<font color="Crimson"><strong>Flux</strong></font>是Facebook开发的一个框架。在标准的MVC框架中，数据可以在UI组件和存储之间双向流动，而Redux严格限制了数据只能在一个方向上流动。 见下图：</p> <div align="center"><img src="data:image/png;base64,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"></div> <p>在Redux中，所有的数据（比如state）被保存在一个被称为<font color="Crimson"><strong>store</strong></font>的容器中 → 在一个应用程序中只能有一个。<font color="Crimson"><strong>store</strong></font>本质上是一个状态树，保存了所有对象的状态。任何UI组件都可以直接从<font color="Crimson"><strong>store</strong></font>访问特定对象的状态。要通过本地或远程组件更改状态，需要分发一个<font color="Crimson"><strong>action</strong></font>。分发在这里意味着将可执行信息发送到<font color="Crimson"><strong>store</strong></font>。当一个<font color="Crimson"><strong>store</strong></font>接收到一个<font color="Crimson"><strong>action</strong></font>，它将把这个<font color="Crimson"><strong>action</strong></font>代理给相关的reducer。reducer是一个纯函数，它可以查看之前的状态，执行一个<font color="Crimson"><strong>action</strong></font>并且返回一个新的状态。</p> <h2 id="配置redux"><a href="#配置redux" class="header-anchor">#</a> 配置Redux</h2> <p>配置Redux开发环境的最快方法是使用<font color="Crimson"><strong>create-react-app</strong></font>工具。在开始之前，确保已经安装并更新了<font color="Crimson"><strong>nodejs，npm</strong></font>或<font color="Crimson"><strong>yarn</strong></font>。我们生成一个<font color="Crimson"><strong>redux-shopping-cart</strong></font>项目并安装Redux：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>create<span class="token operator">-</span>react<span class="token operator">-</span>app redux<span class="token operator">-</span>shopping<span class="token operator">-</span>cart

cd redux<span class="token operator">-</span>shopping<span class="token operator">-</span>cart
yarn add redux # 或者npm install redux
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>首先，删除<font color="Crimson"><strong>src</strong></font>文件夹中除<font color="Crimson"><strong>index.js</strong></font>以外的所有文件。打开<font color="Crimson"><strong>index.js</strong></font>，删除所有代码，键入以下内容：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;redux&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> state<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol><li>首先，我们从redux包中引入<font color="Crimson"><strong>createStore()</strong></font>方法。</li> <li>我们创建了一个名为<strong>reducer</strong>的方法。第一个参数<font color="Crimson"><strong>state</strong></font>是当前保存在<font color="Crimson"><strong>store</strong></font>中的数据，第二个参数<font color="Crimson"><strong>action</strong></font>是一个容器，用于：<br> <font color="Crimson"><strong>type</strong></font> - 一个简单的字符串常量，例如ADD, UPDATE, DELETE等。<br> <font color="Crimson"><strong>payload</strong></font> - 用于更新状态的数据。</li> <li>我们创建一个Redux存储区，它只能使用reducer作为参数来构造。存储在Redux存储区中的数据可以被直接访问，但只能通过提供的reducer进行更新。</li></ol> <p>注意到，我在第二点中所提到<font color="Crimson"><strong>state</strong></font>。目前，<font color="Crimson"><strong>state</strong></font>为undefined或null。要解决这个问题，需要分配一个默认的值给<font color="Crimson"><strong>state</strong></font>，使其成为一个空数组：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> state<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>让我们更进一步</strong>。目前我们创建的reducer是通用的。它的名字没有描述它的用途。那么我们如何使用多个reducer呢？我们将用到Redux包中提供的<font color="Crimson"><strong>combineReducers</strong></font>函数。修改代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// src/index.js</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;redux&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> combineReducers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">productsReducer</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> state<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">cartReducer</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> state<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> allReducers <span class="token operator">=</span> <span class="token punctuation">{</span>
  products<span class="token operator">:</span> productsReducer<span class="token punctuation">,</span>
  shoppingCart<span class="token operator">:</span> cartReducer
<span class="token punctuation">}</span>

<span class="token keyword">const</span> rootReducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span>allReducers<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>rootReducer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>在上面的代码中，我们将通用的reducer修改为<font color="Crimson"><strong>productReducer</strong></font>和<font color="Crimson"><strong>cartReducer</strong></font>。创建这两个空的reducer是为了展示如何在一个<font color="Crimson"><strong>store</strong></font>中使用<font color="Crimson"><strong>combineReducers</strong></font>函数组合多个reducer。</p> <p><strong>接下来</strong>，我们将为reducer定义一些测试数据。修改代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// src/index.js</span>

…

<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span>
  cart<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      product<span class="token operator">:</span> <span class="token string">'bread 700g'</span><span class="token punctuation">,</span>
      quantity<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      unitCost<span class="token operator">:</span> <span class="token number">90</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      product<span class="token operator">:</span> <span class="token string">'milk 500ml'</span><span class="token punctuation">,</span>
      quantity<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      unitCost<span class="token operator">:</span> <span class="token number">47</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">cartReducer</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">=</span>initialState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> state<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

…

<span class="token keyword">let</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>rootReducer<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;initial state: &quot;</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>我们使用<font color="Crimson"><strong>store.getState()</strong></font>在控制台中打印出当前的状态。你可以在终端中执行<font color="Crimson"><strong>npm start</strong></font>或者<font color="Crimson"><strong>yarn start</strong></font>来运行dev服务器。并在控制台中查看<font color="Crimson"><strong>state</strong></font>。</p> <div align="center"><img src="/assets/img/2.92cf806d.png"></div> <p>现在，我们的<font color="Crimson"><strong>cartReducer</strong></font>什么也没做，但它应该在Redux的存储区中管理购物车商品的状态。我们需要定义添加、更新和删除商品的操作(<font color="Crimson"><strong>action</strong></font>)。我们首先定义<font color="Crimson"><strong>ADD_TO_CART</strong></font>的逻辑：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// src/index.js</span>

…

<span class="token keyword">const</span> <span class="token constant">ADD_TO_CART</span> <span class="token operator">=</span> <span class="token string">'ADD_TO_CART'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">cartReducer</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">=</span>initialState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token constant">ADD_TO_CART</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>state<span class="token punctuation">,</span>
        cart<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">.</span>cart<span class="token punctuation">,</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

…
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>我们继续来分析一下代码。一个reducer需要处理不同的<font color="Crimson"><strong>action</strong></font>类型，因此我们需要一个<font color="Crimson"><strong>SWITCH</strong></font>语句。当一个<font color="Crimson"><strong>ADD_TO_CART</strong></font>类型的<font color="Crimson"><strong>action</strong></font>在应用程序中分发时，switch中的代码将处理它。
正如你所看到的，我们将<font color="Crimson"><strong>action.payload</strong></font>中的数据与现有的state合并以创建一个新的state。</p> <p>接下来，我们将定义一个<font color="Crimson"><strong>action</strong></font>，作为<font color="Crimson"><strong>store.dispatch()</strong></font>的一个参数。<font color="Crimson"><strong>action</strong></font>是一个Javascript对象，有一个必须的type和可选的payload。我们在<font color="Crimson"><strong>cartReducer</strong></font>函数后定义一个：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token parameter">product<span class="token punctuation">,</span> quantity<span class="token punctuation">,</span> unitCost</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token constant">ADD_TO_CART</span><span class="token punctuation">,</span>
    payload<span class="token operator">:</span> <span class="token punctuation">{</span> product<span class="token punctuation">,</span> quantity<span class="token punctuation">,</span> unitCost <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>在这里，我们定义了一个函数，返回一个JavaScript对象。在我们分发消息之前，我们添加一些代码，让我们能够监听<font color="Crimson"><strong>store</strong></font>事件的更改。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> unsubscribe <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>接下来，我们通过分发消息到<font color="Crimson"><strong>store</strong></font>来向购物车中添加商品。将下面的代码添加在<font color="Crimson"><strong>unsubscribe()</strong></font>之前：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token string">'Coffee 500gm'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token string">'Flour 1kg'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token string">'Juice 2L'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>下面是整个index.js文件：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// src/index.js</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;redux&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> combineReducers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">productsReducer</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> state<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span>
  cart<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      product<span class="token operator">:</span> <span class="token string">'bread 700g'</span><span class="token punctuation">,</span>
      quantity<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      unitCost<span class="token operator">:</span> <span class="token number">90</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      product<span class="token operator">:</span> <span class="token string">'milk 500ml'</span><span class="token punctuation">,</span>
      quantity<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      unitCost<span class="token operator">:</span> <span class="token number">47</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token constant">ADD_TO_CART</span> <span class="token operator">=</span> <span class="token string">'ADD_TO_CART'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">cartReducer</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">=</span>initialState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token constant">ADD_TO_CART</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>state<span class="token punctuation">,</span>
        cart<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">.</span>cart<span class="token punctuation">,</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token parameter">product<span class="token punctuation">,</span> quantity<span class="token punctuation">,</span> unitCost</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token constant">ADD_TO_CART</span><span class="token punctuation">,</span>
    payload<span class="token operator">:</span> <span class="token punctuation">{</span>
      product<span class="token punctuation">,</span>
      quantity<span class="token punctuation">,</span>
      unitCost
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> allReducers <span class="token operator">=</span> <span class="token punctuation">{</span>
  products<span class="token operator">:</span> productsReducer<span class="token punctuation">,</span>
  shoppingCart<span class="token operator">:</span> cartReducer
<span class="token punctuation">}</span>

<span class="token keyword">const</span> rootReducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span>allReducers<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>rootReducer<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;initial state: &quot;</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> unsubscribe <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token string">'Coffee 500gm'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token string">'Flour 1kg'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token string">'Juice 2L'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div><p>保存代码后，Chrome会自动刷新。可以在控制台中确认新的商品已经添加了。</p> <div align="center"><img src="/assets/img/3.43c8f62d.png"></div> <h2 id="组织redux代码"><a href="#组织redux代码" class="header-anchor">#</a> 组织Redux代码</h2> <p><font color="Crimson"><strong>index.js</strong></font>中的代码逐渐变得冗杂。我把所有的代码都写在<font color="Crimson"><strong>index.js</strong></font>中是为了起步时的简单易懂。接下来，我们来看一下如何组织Redux项目。首先，在<font color="Crimson"><strong>src</strong></font>文件夹中创建一下文件和文件夹：</p> <p>src/<br>
├── actions<br>
│ └── cart-actions.js<br>
├── index.js<br>
├── reducers<br>
│ ├── cart-reducer.js<br>
│ ├── index.js<br>
│ └── products-reducer.js<br>
└── store.js</p> <p>然后，我们把<font color="Crimson"><strong>index.js</strong></font>中的代码进行整理：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// src/actions/cart-actions.js</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">ADD_TO_CART</span> <span class="token operator">=</span> <span class="token string">'ADD_TO_CART'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token parameter">product<span class="token punctuation">,</span> quantity<span class="token punctuation">,</span> unitCost</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token constant">ADD_TO_CART</span><span class="token punctuation">,</span>
    payload<span class="token operator">:</span> <span class="token punctuation">{</span> product<span class="token punctuation">,</span> quantity<span class="token punctuation">,</span> unitCost <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// src/reducers/products-reducer.js</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> state<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// src/reducers/cart-reducer.js</span>

<span class="token keyword">import</span>  <span class="token punctuation">{</span> <span class="token constant">ADD_TO_CART</span> <span class="token punctuation">}</span>  <span class="token keyword">from</span> <span class="token string">'../actions/cart-actions'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span>
  cart<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      product<span class="token operator">:</span> <span class="token string">'bread 700g'</span><span class="token punctuation">,</span>
      quantity<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      unitCost<span class="token operator">:</span> <span class="token number">90</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      product<span class="token operator">:</span> <span class="token string">'milk 500ml'</span><span class="token punctuation">,</span>
      quantity<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      unitCost<span class="token operator">:</span> <span class="token number">47</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">=</span>initialState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token constant">ADD_TO_CART</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>state<span class="token punctuation">,</span>
        cart<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">.</span>cart<span class="token punctuation">,</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// src/reducers/index.js</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> combineReducers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> productsReducer <span class="token keyword">from</span> <span class="token string">'./products-reducer'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> cartReducer <span class="token keyword">from</span> <span class="token string">'./cart-reducer'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> allReducers <span class="token operator">=</span> <span class="token punctuation">{</span>
  products<span class="token operator">:</span> productsReducer<span class="token punctuation">,</span>
  shoppingCart<span class="token operator">:</span> cartReducer
<span class="token punctuation">}</span>

<span class="token keyword">const</span> rootReducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span>allReducers<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> rootReducer<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// src/store.js</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;redux&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> rootReducer <span class="token keyword">from</span> <span class="token string">'./reducers'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>rootReducer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// src/index.js</span>

<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> addToCart <span class="token punctuation">}</span>  <span class="token keyword">from</span> <span class="token string">'./actions/cart-actions'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;initial state: &quot;</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> unsubscribe <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token string">'Coffee 500gm'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token string">'Flour 1kg'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token string">'Juice 2L'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>整理完代码之后，程序依然会正常运行。现在我们来添加修改和删除购物车中商品的逻辑。修改<font color="Crimson"><strong>cart-actions.js</strong></font>和<font color="Crimson"><strong>cart-reducer.js</strong></font>文件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// src/reducers/cart-actions.js</span>
…
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">UPDATE_CART</span> <span class="token operator">=</span> <span class="token string">'UPDATE_CART'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">DELETE_FROM_CART</span> <span class="token operator">=</span> <span class="token string">'DELETE_FROM_CART'</span><span class="token punctuation">;</span>
…
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">updateCart</span><span class="token punctuation">(</span><span class="token parameter">product<span class="token punctuation">,</span> quantity<span class="token punctuation">,</span> unitCost</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token constant">UPDATE_CART</span><span class="token punctuation">,</span>
    payload<span class="token operator">:</span> <span class="token punctuation">{</span>
      product<span class="token punctuation">,</span>
      quantity<span class="token punctuation">,</span>
      unitCost
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">deleteFromCart</span><span class="token punctuation">(</span><span class="token parameter">product</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token constant">DELETE_FROM_CART</span><span class="token punctuation">,</span>
    payload<span class="token operator">:</span> <span class="token punctuation">{</span>
      product
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// src/reducers/cart-reducer.js</span>
…
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">=</span>initialState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token constant">ADD_TO_CART</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>state<span class="token punctuation">,</span>
        cart<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">.</span>cart<span class="token punctuation">,</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">case</span> <span class="token constant">UPDATE_CART</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>state<span class="token punctuation">,</span>
        cart<span class="token operator">:</span> state<span class="token punctuation">.</span>cart<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>product <span class="token operator">===</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>product <span class="token operator">?</span> action<span class="token punctuation">.</span>payload <span class="token operator">:</span> item<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">case</span> <span class="token constant">DELETE_FROM_CART</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>state<span class="token punctuation">,</span>
        cart<span class="token operator">:</span> state<span class="token punctuation">.</span>cart<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>product <span class="token operator">!==</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>product<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>最后，我们在<font color="Crimson"><strong>index.js</strong></font>中分发这两个<font color="Crimson"><strong>action</strong></font>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// src/index.js</span>
…
<span class="token comment">// Update Cart</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">updateCart</span><span class="token punctuation">(</span><span class="token string">'Flour 1kg'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Delete from Cart</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">deleteFromCart</span><span class="token punctuation">(</span><span class="token string">'Coffee 500gm'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
…
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="使用redux工具调试"><a href="#使用redux工具调试" class="header-anchor">#</a> 使用Redux工具调试</h2> <p>Redux拥有很多第三方的调试工具，可用于分析代码和修复bug。最受欢迎的是<strong>time-travelling tool</strong>，即<a href="https://www.npmjs.com/package/redux-devtools-extension" target="_blank" rel="noopener noreferrer">redux-devtools-extension<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。设置它只需要三个步骤。</p> <ul><li><p>首先，在Chrome中安装<a href="https://chrome.google.com/webstore/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd?hl=en" target="_blank" rel="noopener noreferrer">Redux Devtools<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>扩展。</p></li> <li><p>然后，在运行Redux应用程序的终端里使用<font color="Crimson"><strong>Ctrl+C</strong></font>停止服务器。并用npm或yarn安装<font color="Crimson"><strong>redux-devtools-extension</strong></font>包。</p></li> <li><p>一旦安装完成，我们对<font color="Crimson"><strong>store.js</strong></font>稍作修改：</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// src/store.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;redux&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> composeWithDevTools <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux-devtools-extension'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> rootReducer <span class="token keyword">from</span> <span class="token string">'./reducers'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>rootReducer<span class="token punctuation">,</span> <span class="token function">composeWithDevTools</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>我们还可以把src/index.js中日志相关的代码删除掉。返回Chrome，右键单击该工具的图标，打开Redux DevTools面板：</p> <div align="center"><img src="/assets/img/4.62b7c607.png"></div> <div align="center"><img src="/assets/img/5.3f6e7216.png"></div> <p>可以看到，<font color="Crimson"><strong>Redux Devtools</strong></font>很强大。你可以在<font color="Crimson"><strong>action</strong></font>, <font color="Crimson"><strong>state</strong></font>和<font color="Crimson"><strong>diff</strong></font>(方法差异)之间切换。选择左侧面板上的不同<font color="Crimson"><strong>action</strong></font>，观察状态树的变化。你还可以通过进度条来播放<font color="Crimson"><strong>actions</strong></font>序列。甚至可以通过工具直接分发操作信息。具体的请查看文档。</p> <h2 id="集成react"><a href="#集成react" class="header-anchor">#</a> 集成React</h2> <p>在本文开头，我提到Redux可以很方便的与React集成。只需要简单的几步。</p> <ul><li>首先，停止服务器，并安装<font color="Crimson"><strong>react-redux</strong></font>包：</li></ul> <div class="language-node.js line-numbers-mode"><pre class="language-text"><code>yarn add react-redux
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>接下来，在<font color="Crimson"><strong>index.js</strong></font>中加入React代码。我们还将使用<font color="Crimson"><strong>Provider</strong></font>类将React应用程序包装在Redux容器中：</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// src/index.js</span>
…
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Redux Shopping Cart<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">;</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span>
    <span class="token punctuation">{</span> App <span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span> <span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
…
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>目前，已经完成了集成的第一部分。可以启动服务器以查看效果。第二部分涉及到使用刚刚安装的<font color="Crimson"><strong>react-redux</strong></font>包中的几个方法。通过这些方法将React组件与Redux的<font color="Crimson"><strong>store</strong></font>和<font color="Crimson"><strong>action</strong></font>相关联。此外，还可以使用<a href="https://expressjs.com/" target="_blank" rel="noopener noreferrer">Express<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>和<a href="https://feathersjs.com/" target="_blank" rel="noopener noreferrer">Feathers<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>这样的框架来设置API。API将为我们的应用程序提供对数据库服务的访问。</p> <p>在Redux中，我们还可以安装其他一些包，比如<font color="Crimson"><strong>axios</strong></font>等。我们React组件的<font color="Crimson"><strong>state</strong></font>将由Redux处理，确保所有组件与数据库API的同步。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/react/create-react-app.html" class="prev">
        create-react-app
      </a></span> <span class="next"><a href="/react/生命周期函数.html">
        React的生命周期函数
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6d0ab0d3.js" defer></script><script src="/assets/js/2.fa3326c1.js" defer></script><script src="/assets/js/13.0c0f46e8.js" defer></script>
  </body>
</html>
